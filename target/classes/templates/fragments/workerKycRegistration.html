<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>KushalKart Admin - Worker KYC Registration</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport" />
  <link rel="icon" href="/admin-ui/img/kaiadmin/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="/admin-ui/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/admin-ui/css/plugins.min.css" />
  <link rel="stylesheet" href="/admin-ui/css/kaiadmin.min.css" />
  <link rel="stylesheet" href="/admin-ui/css/demo.css" />
  <style>
    label { font-weight: 500; }
    .image-preview { max-width: 160px; max-height: 160px; border: 1px solid #ccc; margin-bottom: 6px;}
  </style>
</head>
<body>
<div class="wrapper">
  <div th:replace="fragments/sidebar :: sidebar"></div>
  <div class="main-panel">
    <div class="container">
      <div class="page-inner">
        <div class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4">
          <div>
            <h3 class="fw-bold mb-3">Worker KYC Registration</h3>
            <h6 class="op-7 mb-2">View and update KYC information</h6>
          </div>
        </div>

        <form id="kycForm" action="/admin/worker/kyc/update" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
          <div class="row g-3">
            <input type="hidden" name="id" id="workerId" />
            <input type="hidden" name="adminId" value="1" />
            <div class="col-md-6">
              <label for="name" class="form-label">Name</label>
              <input type="text" id="name" name="name" class="form-control" readonly />
            </div>
            <div class="col-md-6">
              <label for="username" class="form-label">Username</label>
              <input type="text" id="username" name="username" class="form-control" readonly />
            </div>
            <div class="col-md-6">
              <label for="mobile" class="form-label">Mobile</label>
              <input type="text" id="mobile" name="mobile" class="form-control" readonly />
            </div>
            <div class="col-md-6">
              <label for="email" class="form-label">Email</label>
              <input type="email" id="email" name="email" class="form-control" readonly />
            </div>
            <div class="col-md-6">
              <label for="aadhaarNumber" class="form-label">Aadhaar Number</label>
              <input type="text" id="aadhaarNumber" name="aadhaarNumber" class="form-control" maxlength="20" required />
            </div>
            <!-- Aadhaar Front Image -->
            <div class="col-md-6">
              <label class="form-label">Aadhaar Front</label>
              <div id="aadhaarFrontPreview"></div>
              <input type="file" id="aadhaarFront" name="aadhaarFront" accept="image/*" class="form-control" />
            </div>
            <!-- Aadhaar Back Image -->
            <div class="col-md-6">
              <label class="form-label">Aadhaar Back</label>
              <div id="aadhaarBackPreview"></div>
              <input type="file" id="aadhaarBack" name="aadhaarBack" accept="image/*" class="form-control" />
            </div>
            <!-- Worker Photo Image -->
            <div class="col-md-6">
              <label class="form-label">Worker Photo</label>
              <div id="workerPhotoPreview"></div>
              <input type="file" id="workerPhoto" name="workerPhoto" accept="image/*" class="form-control" />
            </div>
            <div class="col-md-6">
              <label for="kycStatus" class="form-label">KYC Status</label>
              <select id="kycStatus" name="kycStatus" class="form-control" required>
                <option value="PENDING">PENDING</option>
                <option value="APPROVED">APPROVED</option>
                <option value="REJECTED">REJECTED</option>
              </select>
              <div class="invalid-feedback">
                Please select a KYC status.
              </div>
            </div>
            <div class="col-md-6">
              <label for="verified" class="form-label">Verified</label>
              <select id="verified" name="verified" class="form-control" required>
                <option value="true">Yes</option>
                <option value="false">No</option>
              </select>
              <div class="invalid-feedback">
                Please select verified status.
              </div>
            </div>
            <div class="col-12 mt-3">
              <button class="btn btn-success" type="submit">Save KYC Info</button>
              <a href="/admin/workers" class="btn btn-secondary ms-2">Back to List</a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Scripts -->
<script src="/admin-ui/js/core/jquery-3.7.1.min.js"></script>
<script src="/admin-ui/js/core/bootstrap.min.js"></script>
<script>
  $(document).ready(function() {
    const params = new URLSearchParams(window.location.search);
    const workerId = params.get('id');
    if (workerId) {
      $.get(`/admin/workers?id=${workerId}`, function(data) {
        const worker = Array.isArray(data.content) ? data.content[0] : data;
        if (worker) {
          $('#workerId').val(worker.id);
          $('#name').val(worker.name || '');
          $('#username').val(worker.username || '');
          $('#mobile').val(worker.mobile || '');
          $('#email').val(worker.email || '');
          $('#aadhaarNumber').val(worker.aadhaarNumber || '');
          $('#kycStatus').val(worker.kycStatus || 'PENDING');
          $('#verified').val(worker.verified ? 'true' : 'false');
          // Preview images if URLs exist
          if(worker.aadhaarFront) {
            $('#aadhaarFrontPreview').html(`<img src="${worker.aadhaarFront}" class="image-preview" alt="Aadhaar Front"/>`);
          }
          if(worker.aadhaarBack) {
            $('#aadhaarBackPreview').html(`<img src="${worker.aadhaarBack}" class="image-preview" alt="Aadhaar Back"/>`);
          }
          if(worker.workerPhoto) {
            $('#workerPhotoPreview').html(`<img src="${worker.workerPhoto}" class="image-preview" alt="Worker Photo"/>`);
          }
        }
      });
    }
  });

  (() => {
    'use strict'
    const forms = document.querySelectorAll('.needs-validation')
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }
        form.classList.add('was-validated')
      }, false)
    })
  })()
</script>
</body>
</html>
